{
  "name": "SSH Hardening",
  "description": "Harden SSH configuration to prevent brute-force and unauthorized access",
  "category": "hardening",
  "severity": "medium",
  "steps": [
    {
      "name": "Backup SSH config",
      "function": "cmd.run",
      "command": "cp /etc/ssh/sshd_config /etc/ssh/sshd_config.bak.$(date +%s)",
      "timeout": 10000,
      "required": true
    },
    {
      "name": "Disable root login",
      "function": "cmd.run",
      "command": "sed -i 's/^#*PermitRootLogin.*/PermitRootLogin no/' /etc/ssh/sshd_config",
      "timeout": 10000,
      "required": true
    },
    {
      "name": "Disable password authentication",
      "function": "cmd.run",
      "command": "sed -i 's/^#*PasswordAuthentication.*/PasswordAuthentication no/' /etc/ssh/sshd_config",
      "timeout": 10000,
      "required": false
    },
    {
      "name": "Set SSH protocol to 2",
      "function": "cmd.run",
      "command": "grep -q '^Protocol' /etc/ssh/sshd_config && sed -i 's/^Protocol.*/Protocol 2/' /etc/ssh/sshd_config || echo 'Protocol 2' >> /etc/ssh/sshd_config",
      "timeout": 10000,
      "required": true
    },
    {
      "name": "Disable empty passwords",
      "function": "cmd.run",
      "command": "sed -i 's/^#*PermitEmptyPasswords.*/PermitEmptyPasswords no/' /etc/ssh/sshd_config",
      "timeout": 10000,
      "required": true
    },
    {
      "name": "Set max auth tries",
      "function": "cmd.run",
      "command": "grep -q '^MaxAuthTries' /etc/ssh/sshd_config && sed -i 's/^MaxAuthTries.*/MaxAuthTries 3/' /etc/ssh/sshd_config || echo 'MaxAuthTries 3' >> /etc/ssh/sshd_config",
      "timeout": 10000,
      "required": true
    },
    {
      "name": "Restart SSH service",
      "function": "cmd.run",
      "command": "systemctl restart sshd || service sshd restart || service ssh restart",
      "timeout": 30000,
      "required": true
    }
  ]
}
